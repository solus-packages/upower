From a19bb0cdffe3a37906f2216b41c6cb9cc6418b95 Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@streambits.io>
Date: Wed, 18 Sep 2019 18:41:40 +0300
Subject: [PATCH 1/1] Support a fully stateless configuration

---
 etc/Makefile.am | 2 +-
 src/up-config.c | 8 +++++++-
 2 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/etc/Makefile.am b/etc/Makefile.am
index 94d5548..7c7ad16 100644
--- a/etc/Makefile.am
+++ b/etc/Makefile.am
@@ -1,4 +1,4 @@
-configdir = $(sysconfdir)/UPower
+configdir = $(datadir)/UPower
 config_DATA = UPower.conf
 
 EXTRA_DIST =						\
diff --git a/src/up-config.c b/src/up-config.c
index f842ede..6f9453b 100644
--- a/src/up-config.c
+++ b/src/up-config.c
@@ -102,9 +102,15 @@ up_config_init (UpConfig *config)
 	config->priv->keyfile = g_key_file_new ();
 
 	filename = g_strdup (g_getenv ("UPOWER_CONF_FILE_NAME"));
-	if (filename == NULL)
+	if (filename == NULL) {
 		filename = g_build_filename (PACKAGE_SYSCONF_DIR,"UPower", "UPower.conf", NULL);
 
+		if (!g_file_test(filename, G_FILE_TEST_EXISTS)) {
+			g_free(filename);
+			filename = g_build_filename (PACKAGE_DATA_DIR, "UPower", "UPower.conf", NULL);
+		}
+	}
+
 	/* load */
 	ret = g_key_file_load_from_file (config->priv->keyfile,
 					 filename,
-- 
2.23.0

